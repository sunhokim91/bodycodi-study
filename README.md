# spring-rest-doc-swagger ì ìš©

## ì„œë¡ 
ìŠ¤í”„ë§ì—ì„œ APIë¬¸ì„œ ë§Œë“œëŠ” ë°©ë²•ì¤‘ì—ëŠ” rest-docì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ê³¼ swaggerë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ ë‘˜ì€ ê°ê°ì˜ ì¥ì ê³¼ ë‹¨ì ì„ ê°€ì§€ê³  ìˆê¸°ì— ë‘˜ì˜ ì¥ì ì„ í¬ìš©í•˜ì—¬ APIë¬¸ì„œë¡œ ë§Œë“¤ ìˆ˜ ìˆë‹¤ë©´ ì‹œë„ˆì§€ê°€ ë§ì´ ì¼ì–´ë‚  ê²ƒìœ¼ë¡œ ë³´ì—¬ì§‘ë‹ˆë‹¤.


### ìŠ¤í”„ë§ rest docê³¼ swagger íŠ¹ì§•
ìŠ¤í”„ë§ rest docì˜ ê²½ìš° í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ í†µí•´ API ë¬¸ì„œë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì„œë¹„ìŠ¤ ì½”ë“œì— ì˜í–¥ì„ ì£¼ì§€ ì•Šê³  í…ŒìŠ¤íŠ¸ë¥¼ ê°•ì œí•  ìˆ˜ ìˆë‹¤ëŠ” ì ì—ì„œ ì¢‹ì§€ë§Œ ë””ìì¸ ì¸¡ë©´ì´ ë–¨ì–´ì§€ê³  APIë¬¸ì„œë¥¼ í†µí•´ APIí…ŒìŠ¤íŠ¸ë¥¼ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë˜í•œ rest docì„¤ì •ê³¼ í…ŒìŠ¤íŠ¸ ì½”ë“œì™€ ë”ë¶ˆì–´ adocíŒŒì¼ì—ë„ ìˆ˜ì •ì´ í•„ìš”í•œ ì ì´ ìˆë‹¤ëŠ” ë‹¨ì ì´ ì¡´ì¬í•©ë‹ˆë‹¤.

swaggerì˜ ê²½ìš° rest docê³¼ ë°˜ëŒ€ë¡œ ë””ìì¸ ì¸¡ë©´ì´ ë›°ì–´ë‚˜ê³  API ë¬¸ì„œë¥¼ í†µí•´ APIë¥¼ í˜¸ì¶œí•˜ì—¬ í…ŒìŠ¤íŠ¸ë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì„œë¹„ìŠ¤ ì½”ë“œì— ì£¼ì„ì„ ë‹¬ì•„ì•¼ í•˜ê³  ë¬¸ì„œë§Œìœ¼ë¡œ ëª¨ë“  ì—°ë™ ì‹œìŠ¤í…œì„ êµ¬í˜„í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

### OPEN API 3.0 Spcipication(OAS)
OpenAPI Specification (OAS) ì€ RESTful API ë¥¼ ê¸°ìˆ í•˜ëŠ” í‘œì¤€ìœ¼ë¡œ ì„œë¹„ìŠ¤ì—ì„œ ì œê³µí•˜ëŠ” API ì˜ ê¸°ëŠ¥ê³¼ End Pointë¥¼ ê°œë°œìë‚˜ ì‹œìŠ¤í…œì´ ìë™ìœ¼ë¡œ ë°œê²¬í•˜ê³  ì²˜ë¦¬í•˜ëŠ”ë° í•„ìš”í•œ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

ë˜í•œ OAS ëŠ” json ì´ë‚˜ yml í˜•ì‹ìœ¼ë¡œ ê¸°ìˆ í•´ì•¼ í•˜ë©° OAS íŒŒì¼ì„ ì½ì–´ì„œ ë””í”Œë¡œì´ í•´ì£¼ëŠ” ë„êµ¬(Ex: swagger-ui)ë¥¼ ì‚¬ìš©í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ë¸Œë¼ìš°ì €ì—ì„œ í¸ë¦¬í•˜ê²Œ API ë¬¸ì„œë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê·¸ë¦¬ê³  OASì˜ ëŒ€í‘œì ìœ¼ë¡œ swaggerì™€ rest docì´ ìˆëŠ”ë°, OASë¥¼ ì‚¬ìš©í•˜ë©´ rest doc í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ swagger-uië¡œ ë³€ê²½í•  ìˆ˜ ìˆëŠ” ì¸í„°í˜ì´ìŠ¤ ì—­í• ë„ ì„œí¬íŠ¸í•©ë‹ˆë‹¤.

## ğŸ“Œ ì‹¤ìŠµ
### ë²„ì „
1. ìŠ¤í”„ë§ ë²„ì „: 2.7.8
2. ìë°” ë²„ì „: 11
### ê¸°ëŠ¥
1. ë¡œê·¸ì¸ ê¸°ëŠ¥: APIë¬¸ì„œì— ì¼ë°˜ ì‚¬ëŒë“¤ì´ ì ‘ê·¼í•˜ì§€ ëª»í•˜ê²Œ í•´ì•¼ í•˜ê¸°ì— ë¡œê·¸ì¸ ê¸°ëŠ¥ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
2. swagger-uië„ì»¤ë¥¼ í†µí•´ swaggerë¬¸ì„œë¥¼ ë„ìš°ëŠ” ê²Œ ì•„ë‹Œ spring í”„ë¡œì íŠ¸ë¡œ swaggerë¬¸ì„œë¥¼ ë„ìš°ëŠ” í˜•ì‹ìœ¼ë¡œ ê°œë°œí•©ë‹ˆë‹¤.

swagger-uië‹¤ìš´ë¡œë“œ -> distí´ë”ì— ìˆëŠ” ë‚´ìš©ë§Œ ê°€ì ¸ì˜µë‹ˆë‹¤.

### ğŸ“Œ ë©”ì´ë¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€

### íƒ€ì„ë¦¬í”„
íƒ€ì„ë¦¬í”„ëŠ” í”íˆ ë·° í…œí”Œë¦¿(View Template)ì´ë¼ ë¶€ë¥´ë©° ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì „ë‹¬í•˜ëŠ” ë°ì´í„°ë¥¼ ì´ìš©í•˜ì—¬ ë™ì ìœ¼ë¡œ í™”ë©´ì„ êµ¬ì„±í•˜ê²Œ í•´ì¤ë‹ˆë‹¤. html íƒœê·¸ì— ì†ì„±ì„ ì¶”ê°€í•´ í˜ì´ì§€ì— ë™ì ìœ¼ë¡œ ê°’ì„ ì¶”ê°€í•˜ê±°ë‚˜ ì²˜ë¦¬í•˜ê³  htmlíƒœê·¸ ê¸°ë°˜ì— th:ì†ì„±ìœ¼ë¡œ ë™ì ì¸ ë·°ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ìŠ¤í”„ë§ ë¶€íŠ¸(Spring Boot)ì—ì„œëŠ” JSP ì‚¬ìš© ì‹œ í˜¸í™˜ ë° í™˜ê²½ì„¤ì •ì— ì–´ë ¤ì›€ì´ ë§ê¸° ë•Œë¬¸ì— íƒ€ì„ë¦¬í”„ ì‚¬ìš© ê¶Œì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤.

ì—¬ê¸°ì„œ íƒ€ì„ë¦¬í”„ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë°˜ë“œì‹œ ìŠ¤í”„ë§ ë¶€íŠ¸ ë²„ì „ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
```xml
<dependency>
	<groupId>org.springframework.boot</groupId>
	<artifactId>spring-boot-starter-thymeleaf</artifactId>
</dependency>
```
ë§Œì•½ ìŠ¤í”„ë§ ë¶€íŠ¸ ì „ìš© íƒ€ì„ë¦¬í”„ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ë¹Œë“œì‹œì—ëŠ” ì—ëŸ¬ê°€ ë‚˜ì§€ ì•Šì§€ë§Œ, ì‹¤ì œ ì‚¬ìš© ì‹œ ì—ëŸ¬ê°€ ë°œìƒ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### rest doc
```xml
<snippetsDirectory>${project.build.directory}/generated-snippets</snippetsDirectory>

<dependency>
	<groupId>org.springframework.restdocs</groupId>
	<artifactId>spring-restdocs-mockmvc</artifactId>
	<scope>test</scope>
</dependency>

<plugin>
	<groupId>org.asciidoctor</groupId>
	<artifactId>asciidoctor-maven-plugin</artifactId>
	<version>1.5.8</version>
		<executions>
			<execution>
				<id>generate-docs</id>
				<phase>package</phase>
				<goals>
					<goal>process-asciidoc</goal>
				</goals>
				<configuration>
					<backend>html</backend>
					<doctype>book</doctype>
					<attributes>
						<snippets>${snippetsDirectory}</snippets>
					</attributes>
						<sourceDirectory>src/docs/asciidoc</sourceDirectory>
				</configuration>
			</execution>
		</executions>
	<dependencies>
		<dependency>
			<groupId>org.springframework.restdocs</groupId>
			<artifactId>spring-restdocs-asciidoctor</artifactId>
			<version>${spring-restdocs.version}</version>
		</dependency>
	</dependencies>
</plugin>
<plugin>
	<artifactId>maven-resources-plugin</artifactId>
	<version>3.3.0</version>
	<executions>
		<execution>
			<id>copy-resources</id>
			<phase>prepare-package</phase>
			<goals>
				<goal>copy-resources</goal>
			</goals>
			<configuration>
				<outputDirectory>
					src/main/resources/static/api/docs
				</outputDirectory>
				<resources>
					<resource>
						<directory>
							${project.build.directory}/generated-docs
						</directory>
					</resource>
				</resources>
			</configuration>
		</execution>
	</executions>
</plugin>
```
### security ë¼ì´ë¸ŒëŸ¬ë¦¬
```xml
<dependency>
	<groupId>org.springframework.security</groupId>
	<artifactId>spring-security-test</artifactId>
	<scope>test</scope>
</dependency>
```
ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë¡œê·¸ì¸ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ ë„£ì–´ì¤ë‹ˆë‹¤.

### OAS ë¼ì´ë¸ŒëŸ¬ë¦¬
```xml
<properties>
	<restdocs-api-spec.version>0.10.0</restdocs-api-spec.version>
	<restdocs-spec.version>0.19</restdocs-spec.version>
</properties>

<repositories>
	<repository>
		<id>jcenter</id>
		<url>https://jcenter.bintray.com</url>
	</repository>
</repositories>

<dependency>
	<groupId>com.epages</groupId>
	<artifactId>restdocs-api-spec</artifactId>
	<version>${restdocs-api-spec.version}</version>
	<scope>test</scope>
</dependency>
<dependency>
	<groupId>com.epages</groupId>
	<artifactId>restdocs-api-spec-mockmvc</artifactId>
	<version>${restdocs-api-spec.version}</version>
	<scope>test</scope>
</dependency>

<pluginRepositories>
	<pluginRepository>
		<id>jcenter</id>
		<url>https://jcenter.bintray.com</url>
	</pluginRepository>
</pluginRepositories>

<plugin>
	<groupId>com.github.berkleytechnologyservices.restdocs-spec</groupId>
	<artifactId>restdocs-spec-maven-plugin</artifactId>
	<version>${restdocs-spec.version}</version>
	<executions>
		<execution>
			<goals>
				<goal>generate</goal>
			</goals>
			<configuration>
				<specification>OPENAPI_V3</specification>
				<format>JSON</format>
				<outputDirectory>${project.build.directory}/classes/static/api/docs</outputDirectory>
			</configuration>
		</execution>
	</executions>
</plugin>
```

## êµ¬í˜„ ì½”ë“œ
### swagger ì—°ë™
swaggerì™€ ì—°ë™í•˜ë ¤ë©´ ë¨¼ì € swagger-uië¥¼ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤. ë§í¬ëŠ” ì•„ë˜ ì°¸ê³ ë§í¬ì—ì„œ ë‹¤ìš´ë°›ìœ¼ë©° ë˜ë©° distí´ë”ì— ìˆëŠ” js, html, cssíŒŒì¼ë§Œ ê°€ì ¸ì˜µë‹ˆë‹¤.

### ë¡œê·¸ì¸ ê¸°ëŠ¥ êµ¬í˜„
#### ë¡œê·¸ì¸ í˜ì´ì§€
MvcConfigureë¥¼ ìƒì†ë°›ì•„ ì»¨íŠ¸ë¡¤ëŸ¬ì˜ êµ¬í˜„ì´ í•„ìš”ì—†ì´ íŠ¹ì • URLì™€ ë§¤í•‘ë˜ëŠ” ì›¹í˜ì´ì§€ ë§í¬ë¥¼ ë„£ì–´ì¤ë‹ˆë‹¤. ì•„ë˜ addViewControllerëŠ” URLì´ê³ , setViewNameì€ íŠ¹ì • ì›¹ í˜ì´ì§€(html)ì…ë‹ˆë‹¤.
```java
@Configuration
public class WebMvcConfig implements WebMvcConfigurer {
    public static final String API_LOGIN = "api/login";

    @Override
    public void addViewControllers(ViewControllerRegistry registry) {
        registry.addViewController("/api").setViewName(API_LOGIN);
        registry.addViewController("/api/login").setViewName(API_LOGIN);
    }
}
```
addViewControllerëŠ” URLì´ê³ , setViewNameì€ íŠ¹ì • ì›¹ í˜ì´ì§€(html)ì…ë‹ˆë‹¤.  ì›¹ í˜ì´ì§€ì˜ ê²½ë¡œëŠ” mavenê³¼ gradleë³„ë¡œ ë‹¤ë¥´ì§€ë§Œ ì €ëŠ” mavenì„ ì‚¬ìš©í–ˆê¸°ì—, templatesì‚¬ìš©í•´ì•¼ í•˜ë©° templatesí´ë”ëŠ” thymeleafì˜ íŒŒì¼ë“¤ì„ ë‘ëŠ” ê³³ì…ë‹ˆë‹¤.

ì—¬ê¸°ì„œ ì£¼ì˜í•  ì ì€ ì›¹í˜ì´ì§€ê°€ ë§¤í•‘ë  ë•Œ íƒ€ì„ë¦¬í”„ì™€ ì—°ê³„ê°€ ë˜ëŠ”ë°, ì´ë•Œ ì ˆëŒ€ê²½ë¡œë¡œ ë„£ì–´ì£¼ë©´ ì•ˆë˜ê³  ìƒëŒ€ê²½ë¡œë¡œ ë„£ì–´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. ìœ„ ì½”ë“œëŠ” IDE(ex: ì¸í…”ë¦¬ì œì´)ì—ì„œëŠ” ë¹Œë“œê°€ ê°€ëŠ¥í•˜ì§€ë§Œ ì‹¤ì œ java ëª…ë ¹ì–´ë¥¼ í†µí•´ jaríŒŒì¼ì„ ì‹¤í–‰í•  ë•Œ ê²½ë¡œë¥¼ ì°¾ì„ ë•Œ ë§ˆì§€ë§‰ì— /ë¥¼ ë¶™ì—¬ íŒŒì¼ ê²½ë¡œë¥¼ ì°¾ê¸°ì— ê²½ë¡œë¥¼ ëª»ì°¾ëŠ” ê²½ìš°ê°€ ë°œìƒí•©ë‹ˆë‹¤. ë”°ë¼ì„œ ìƒëŒ€ê²½ë¡œë¡œ ë§ì¶”ì–´ ì¤ë‹ˆë‹¤.

#### ë¡œê·¸ì¸ ê¸°ëŠ¥
```java
@EnableWebSecurity
public class WebSecurityConfig {
    private static final String API_DOCS_USER_API_HTML = "/api/docs/index.html";
    private static final String LOGIN = "/api/login";

    @Bean
    public UserDetailsService userDetailsService() {
        InMemoryUserDetailsManager manager = new InMemoryUserDetailsManager();

        manager.createUser(User.withUsername("admin")
                .password(passwordEncoder().encode("admin123"))
                .roles(Roles.ADMIN.name())
                .build());
        return manager;
    }

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.sessionManagement()
                .sessionAuthenticationErrorUrl(LOGIN)
                .invalidSessionUrl(LOGIN)
                .and()
                .csrf().disable()
                .authorizeRequests()
                .antMatchers(API_DOCS_USER_API_HTML).hasRole(Roles.ADMIN.name())
                .anyRequest().permitAll()
                .and()
                .formLogin()
                .loginPage(LOGIN)
                .loginProcessingUrl(LOGIN)
                .defaultSuccessUrl(API_DOCS_USER_API_HTML)
                .permitAll();

        return http.build();
    }
}
```
EnableWebSecurityì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì´ë©´ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ê°€ ë°œë™ë©ë‹ˆë‹¤. ì‹œíë¦¬í‹° ê´€ë ¨ ë‚´ìš©ì€ ë‹¤ìŒ í¬ìŠ¤íŠ¸ì—ì„œ ë§ì”€ë“œë¦¬ê³ , ì•ì—ì„œ /api/loginìœ¼ë¡œ ì ‘ì†í•˜ì—¬ ë¡œê·¸ì¸ì„ ì„±ê³µì ìœ¼ë¡œ ë§ˆë¬´ë¦¬í•˜ë©´ API_DOCS_USER_API_HTMLì— swagger-uië¡œ ë‹¤ìš´ë°›ì€ htmlíŒŒì¼ì„ í˜¸ì¶œí•©ë‹ˆë‹¤. htmlíŒŒì¼ì˜ ê²½ìš° ë°˜ë“œì‹œ ë¡œê·¸ì¸ì´ ì„±ê³µë˜ì–´ì•¼ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### ì‹¤ìŠµ ì‹œ ë°œìƒëœ ì´ìŠˆì‚¬í•­
#### 1.ë¹Œë“œ ì˜¤ë¥˜
ë¹Œë“œ ì‹œ `class file has wrong version`ì™€ ê°™ì€ ì˜¤ê°€ ë°œìƒí–ˆëŠ” ë° ì´ëŠ” ìŠ¤í”„ë§ ë²„ì „ê³¼ ìë°” ë²„ì „ì˜ í˜¸í™˜ì´ ë§ì§€ ì•Šì•„ ë°œìƒëœ ë¬¸ì œì…ë‹ˆë‹¤. ë”°ë¼ì„œ ìŠ¤í”„ë§ ë²„ì „ì— ë”°ë¼ ìë°”ë²„ì „ì´ ë§ëŠ” ì§€ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.

#### 2. íƒ€ê²Ÿ ìœ„ì¹˜ì— htmlíŒŒì¼ì´ ìƒê¸°ì§€ ì•ŠëŠ” ì´ìœ 
pluginìœ¼ë¡œ ì•„ë¬´ë¦¬ ì„¤ì¹˜ë¥¼ í•´ë´ë„ generated-docsí´ë”ì— htmlíŒŒì¼ì´ ìƒê¸°ì§€ ì•ŠëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ëŠ” testì½”ë“œì— ì‘ì„±í•œë‹¤ê³  í•´ì„œ htmlíŒŒì¼ì´ ì €ì ˆë¡œ ìƒê¸°ëŠ” ê²ƒì´ ì•„ë‹Œ í•˜ë‚˜ì˜ ->src/docs/api ë°‘ì— adocìœ¼ë¡œ ìƒì„±ëœ íŒŒì¼ì— ë˜ ë‹¤ì‹œ ì¨ì•¼í•©ë‹ˆë‹¤.

#### 3. com.epages.restdocs.apispec.model.ResourceModel Desrializeì—ëŸ¬

```
Cannot deserialize instance of `java.lang.String` out of START_OBJECT token
 at [Source: (File); line: 15, column: 23] (through reference chain: com.epages.restdocs.apispec.model.ResourceModel["request"]->com.epages.restdocs.apispec.model.RequestModel["headers"]->java.util.ArrayList[0]->com.epages.restdocs.apispec.model.HeaderDescriptor["description"])
```
ìœ„ ì—ëŸ¬ëŠ” MockMvcë¡œ rest docí…œí”Œë¦¿ì„ ë§Œë“¤ ë•Œ Headerì— Mediaíƒ€ì…ì„ ë„£ê³  ìˆëŠ” ì§€ í™•ì¸ ë°”ëë‹ˆë‹¤. ë§Œì•½ ê·¸ë ‡ê²Œ ë„£ê³  ìˆë‹¤ë©´ ì˜¤ë¥˜ ë©”ì‹œì§€ ì²˜ëŸ¼ String íƒ€ì…ìœ¼ë¡œ ë„£ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.

## ì°¸ê³  ë§í¬
* git site ì£¼ì†Œ
* https://github.com/swagger-api/swagger-ui
